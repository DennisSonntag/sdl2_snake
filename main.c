#include <SDL2/SDL.h>
#define height 500
#define count 20
int s = height / count;
#define DRAW(rend, st, r, g, b)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \
	SDL_SetRenderDrawColor(rend, r, g, b, 255);                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                \
	SDL_RenderFillRect(rend, &(SDL_Rect){st.x * s, st.y * s, s - 2, s - 2});
#define EQ(s1, s2) if (s1.x == s2.x && s1.y == s2.y)
int main(int argc, char *argv[]) {
	SDL_Window *wind = SDL_CreateWindow("snake", SDL_WINDOWPOS_UNDEFINED, SDL_WINDOWPOS_UNDEFINED, height, height, SDL_WINDOW_SHOWN);
	SDL_Renderer *rend = SDL_CreateRenderer(wind, -1, SDL_RENDERER_ACCELERATED);
	SDL_Point *t = malloc(sizeof(SDL_Point) * (height / s) * (height / s)), p = {10, 10}, f = {15, 15}, v = {0, 0};
	int len = 5, q = 0;
	SDL_Event e;
	while (!q) {
		while (SDL_PollEvent(&e)) {
			switch (e.type) {
			case SDL_QUIT: q = 1; break;
			case SDL_KEYDOWN:
				switch (e.key.keysym.sym) {
				case SDLK_LEFT: v.x != 1 ? (v.x = -1, v.y = 0) : 0; break;
				case SDLK_RIGHT: v.x != -1 ? (v.x = 1, v.y = 0) : 0; break;
				case SDLK_UP: v.y != 1 ? (v.x = 0, v.y = -1) : 0; break;
				case SDLK_DOWN: v.y != -1 ? (v.x = 0, v.y = 1) : 0; break;
				}
			}
		}
		p.x += v.x;
		p.y += v.y;
		if (p.x < 0) p.x = (height / s);
		if (p.y < 1) p.y = (height / s) - 1;
		if (p.x > (height / s)) p.x = 0;
		if (p.y > (height / s) - 1) p.y = 0;
		SDL_SetRenderDrawColor(rend, 0, 0, 0, 255);
		SDL_RenderClear(rend);
		for (int i = 0; i < len; i++) {
			DRAW(rend, t[i], 0, 255, 0);
			EQ(t[i], p) len = 5;
		}
		EQ(f, p) {
			len++;
			f = (SDL_Point){rand() % count, rand() % count};
		}
		else DRAW(rend, t[0], 0, 0, 255);
		for (int i = len - 1; i > 0; i--) t[i] = t[i - 1];
		t[0] = (SDL_Point){p.x, p.y};
		DRAW(rend, f, 255, 0, 0);
		SDL_RenderPresent(rend);
		SDL_Delay(1000 / 15);
	}
	free(t);
	SDL_DestroyRenderer(rend);
	SDL_DestroyWindow(wind);
	SDL_Quit();
	return 0;
}
